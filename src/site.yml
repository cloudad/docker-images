---
- hosts: all
  gather_facts: no
  connection: local

  tags:
    - bootstrap

  pre_tasks:
    - name: begin bootstrap
      debug:
        msg: Bootstraping directory '{{ target_path|path_abspath }}'
      connection: local

  roles:
    - role: bootstrap
      dir: bootstrap/

- hosts: all
  gather_facts: no
  connection: chroot

  tags:
    - provision

  vars:
    ansible_ssh_host: '{{ target_path|path_abspath }}'

  pre_tasks:
    - name: begin provision
      debug:
        msg: Chrooting into directory '{{ ansible_ssh_host }}'
      connection: local

  roles:
    - role: common
    - role: docker-image
