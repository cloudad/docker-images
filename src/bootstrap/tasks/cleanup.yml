---
- name: umount target mountpoints
  command: umount -lR '{{ item }}/'
  with_items:
    - '{{ target_path|path_abspath }}/dev'
    - '{{ target_path|path_abspath }}/proc'
    - '{{ target_path|path_abspath }}/sys'
  when: item|path_ismount

- name: remove target directory
  file:
    path: '{{ target_path|path_abspath }}'
    state: absent
