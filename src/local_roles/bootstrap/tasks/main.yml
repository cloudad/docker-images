---
- name: check variables
  assert:
    that:
      - origin is string and origin|length
      - mirror is string and mirror|length
      - target_path is string and target_path|length
      - codename is string and codename|length
      - arch is string and arch|length
      - components is sequence and components|length
      - packages is none or packages is sequence
      - suites is sequence and suites|length
  tags:
    - always

- name: begin bootstrap
  debug:
    msg: Bootstrap {{ origin|title }} {{ codename|title }} at {{ target_path|path_abspath }}

- name: create target directory
  file:
    path: '{{ target_path|path_abspath }}'
    state: directory

- name: setup basic system
  command: >
    debootstrap
    '--arch={{ arch }}'
    '--components={{ components|join(",") }}'
    {% if packages %}
      '--include={{ packages|join(",") }}'
    {% endif %}
    '--variant=minbase'
    '{{ codename }}'
    '{{ target_path|path_abspath }}'
    '{{ mirror }}'
